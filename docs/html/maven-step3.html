<p>DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT DRAFT</p>
<h1>Maven - Step 3 : Une application Web a tester</h1>
<p>Mantenant qe nous avons les bases de réalisation d’un logicel Java, compilé, testé unitairement, , documenté, packagé et publié via Maven, nous pouvons passer à l’étape suivante: appliquer cette recette à une applicaiton Web.</p>
<h2>Quelques pré-requis</h2>
<p>Afin de monter à bord facilement, il est indispensable d’avoir quelques bases relative la conception et au fonctionnement d’application web aujourd’hui standard; à savoir, comprendre l’approche dite <a href="http://fr.wikipedia.org/wiki/Representational_State_Transfer">orientée REST</a>, et avoir déjà manipulé un serveur d’application Java web.<br />L’idéal serait aussi d’avoir quelques notions autour des EJB et autres composants exotiques du monde JavaEE. Nous considererons que ces notions sont connues et sues.</p>
<p>Nous partirons donc sur une approche JavaEE 6, avec un EJB, une persistence en JPA 2.0 et un web service REST.</p>
<p>Le tout dans un serveur d’application JBoss.</p>
<p>Nous choisirons volontairement <a href="http://www.jboss.org">JBoss</a> pour sa facilité d’intégration avec la chaine d’outils de test unitaire gravitant autour de <a href="http://www.arquillian.org">Arquillian</a>. Outil que nous utiliserons en deuxième partie de cet article pour tester certains composants de notre application.</p>
<h2>Platforme ? comme les chaussures vous voulez dire ?</h2>
<p>Non, par platforme, nous entendons plateforme de développement.</p>
<p>La plateforme de développement est constituée du JDK 1.7 et du serveur JBOSS AS 7.</p>
<p>Sous Linux l’installation de JBoss est assez simple. Référons nous, au besoin, à la <a href="https://docs.jboss.org/author/display/AS7/Installing+and+starting+JBoss+AS+on+Linux,+Unix+or+Mac+OS+X">doc en ligne</a>.</p>
<p>Comme d’habitude, nous installerons jdk via <code>apt-get</code> et serveur dans <code>/opt/tools/java/servers/jbos/as7</code> en respectant les préconisations de l’article <a href="http://mcgivrer.wordpress.com/2012/11/13/set-a-java-development-workstation-on-ubuntu/">Set a Java Development workstation on Ubuntu</a>.</p>
<p>OK, je crois que nous pouvons maintenant nous (re)lancer à la conquète de Maven.</p>
<h2>Maven et le chic web</h2>
<h3>l’éternel JUnit</h3>
<p>Si nous testons des composants non liés à la plateforme JavaEE, comme dans notre article précédent, seul <a href="http://www.junit.org">JUnit</a> est necessaire.<br />Mais dans le cas où nous devons apporter quelques implementation des spécifications JavaEE, la mise en euvre de test se complique tout de suite.</p>
<p>Nous pouvons arriver à résoudre certains problème lié à JPA via des instanciations sauvages sans profiter de <code>CDI</code> ou de <code>PersistenceContext</code>, mais pour les EJB, c’est tout de suite plus chaud.</p>
<p>Aussi, nous allons mettre en oeuvre l’outil ultime de test dans le chapitre suivant: <strong>Arquillian</strong>.</p>
<h3>Environnement de test</h3>
<p>L’environnement de test est aussi le contexte d’exécution de votre code de test unitaire.</p>
<p>bc(java). <code>FixMethodOrder(MethodSorters.NAME_ASCENDING)
public class UserDAOTest(){
    </code>PersistenceContext(unitName=“restwebapp”)<br /> EntityManager em;<br /> …<br /> <code>Test
    public void test_1_insertUser(){
        User user = new User(&quot;prenom&quot;,&quot;nom&quot;,&quot;email</code>domaine.com“);<br /> em.persist(user);<br /> assertTrue(”User has not been saved&quot;,user.getId()!=null);<br /> }<br /> …<br />}</p>
<p>afin que notre annotation fonctionne, nous devons fournir un context à notre test unitaire. C’est ce que va nous apporter Arquillian.</p>
<p>Ajoutons donc cette dépendnce maven à notre <code>pom.xml</code>:</p>
<p>bc(xml).</p>
<!-- 
   Specific dependency management block 
   for arquillian 
-->
<p><dependencyManagement><br /> <dependencies><br /> <dependency><br /> <groupId>org.jboss.arquillian</groupId><br /> <artifactId>arquillian-bom</artifactId><br /> <version>1.1.4.Final</version><br /> <scope>import</scope><br /> <type>pom</type><br /> </dependency><br /> <dependency><br /> <groupId>org.jboss.arquillian.extension</groupId><br /> <artifactId>arquillian-drone-bom</artifactId><br /> <version>1.3.0.Final</version><br /> <type>pom</type><br /> <scope>import</scope><br /> </dependency><br /> </dependencies><br /></dependencyManagement></p>
<p>Il faut alors déclarer les dépendances nécessaires :</p>
<p>bc(xml).</p>
<!--
   Arquillian
-->
<p><dependency><br /> <groupId>org.jboss.arquillian.junit</groupId><br /> <artifactId>arquillian-junit-container</artifactId><br /> <scope>test</scope><br /></dependency></p>
<p>Une fois les dépendances clairement indiquiées, on peut psr à la partie code de notre context de test d’execution. en haut de votre classe JUnit de test, il va falloir indiquer une annotation <strong><code>RunWith(Arquillian.class)* permettant de spécifier à Arquillian qu'il faut batir un context pour cette classe de test.

Il faut ensuite créer une méthde donnant les caractéristiques du packaging à construire pour cette classe de test. vous devrez indiquer les classes dépendances et certains fichiers indispensables à l'execution de JavaEE, comme le fichier </code>beans.xml<code>, ou le fichier </code>persistence.xml@ dans notre cas.
<br />Afin de tester une resource de type persistence, il faut créer une archive Java.
<br />bc.. <code>RunWith(Arquillian.class)
</code>FixMethodOrder<br />public class UserEJBTest {
<br /> <code>PersistenceContext(unitName = &quot;defaultPersistenceUnit&quot;)
  private UserDAO users;

  </code>Deployment<br /> public static JavaArchive createArchiveAndDeploy {<br /> return ShrinkWrap<br /> .create<br /> .addClasses<br /> .addAsResource<br /> .addAsManifestResource;<br /> }
<br /> @Test<br /> public void testFindAll {<br /> List<User> list = users.findAll;<br /> assertTrue &gt; 0);<br /> }<br />}
<br />h3. Arquillian, le sauveur
<br />h2. Tests Unitaires
<br />TODO

<br />h2. Tests d’integration
<br />TODO
<br />h2. Tests End-2-End
<br />TODO

<br />h3. One step beyond
<br />Un serveur embarqué dans l’application, grâce à Maven, c’est possible !
<br /></strong> JBoss</p>
<p>TODO</p>
<ul>
<li>GlassFish</li>
</ul>
<p>TODO</p>
<ul>
<li>TomEE</li>
</ul>
<p>TODO</p>
<ul>
<li>Jetty </li>
</ul>
<p>TODO</p>
